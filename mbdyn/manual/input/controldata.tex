% MBDyn (C) is a multibody analysis code.
% http://www.mbdyn.org
%
% Copyright (C) 1996-2007
%
% Pierangelo Masarati  <masarati@aero.polimi.it>
%
% Dipartimento di Ingegneria Aerospaziale - Politecnico di Milano
% via La Masa, 34 - 20156 Milano, Italy
% http://www.aero.polimi.it
%
% Changing this copyright notice is forbidden.
%
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation (version 2 of the License).
% 
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

\chapter{Control Data}\label{sec:CONTROL-DATA}
This section is read by the manager of all the bulk simulation data, namely
the nodes, the drivers and the elements. It is used to set some global
parameters closely related to the behavior of these entities, to tailor the
initial assembly of the joints in case of structural simulations, and to
tell the data manager how many entities of every type it should expect from
the following sections. Historically this is due to the fact that the data
structure for nodes and elements is allocated at the beginning with fixed
size. This is going to change, giving raise to a ``free'' and resizable
structure. But this practice is to be considered reliable since it allows a
sort of double-check on the entities that are inserted.

\section{Model Control Cards}
The cards are: 

\subsubsection{Skip Initial Joint Assembly}
\begin{verbatim}
    <card> ::= skip initial joint assembly ;
\end{verbatim}
This directive inhibits the execution of the initial joint assembly.
Note that for a model to behave correctly, the initial joint assembly
should always succeed.
A correct model succeeds with 0 iterations, i.e.\ it intrinsically 
satisfies the constraints from the beginning.
However, the initial joint assembly is more than a simple compliance
test; it represents a static preprocessor for models.
See the directives \kw{use} in Section~\ref{sec:CONTROLDATA:USE}
and \kw{initial stiffness} in Section~\ref{sec:CONTROLDATA:INITIALSTIFFNESS}
for more details on performing appropriate initial joint assembly.



\subsubsection{Use}\label{sec:CONTROLDATA:USE}
\begin{verbatim}
    <card> ::= use : <item_list> , in assembly ;
    <item_list> ::= <item> [ , <item_list> ]
    <item> ::= { rigid bodies 
               | gravity
               | forces
               | beams
               | aerodynamic elements
               | loadable elements } 
\end{verbatim}
\kw{joints} are used by default, and cannot be added to the list.
\kw{beams} are used by default, too, but can be added to the list
essentially for backwards compatibility.

\subsubsection{Initial Stiffness}\label{sec:CONTROLDATA:INITIALSTIFFNESS}
\begin{verbatim}
    <card> ::= initial stiffness : <position_stiffness>
                                   [ , <velocity_stiffness> ] ;
\end{verbatim}
This directive affects the stiffness of the dummy springs that constrain
the position and the orientation (\kw{<position\_stiffness>})
and the linear and angular velocity (\kw{<velocity\_stiffness>})
of the structural nodes (either \kw{static} or \kw{dynamic}) 
during the initial assembly; the default is 1.0 for both.
Note that each node can use a specific value; 
see Section~\ref{sec:NODE:STRUCTURAL} for details. \\
\emph{Note that the same value is used for the position and the orientation,
so this stiffness is dimensionally inconsistent; It should really 
be intended as a penalty coefficient.
The same considerations apply to the penalty value for linear 
and angular velocities.}

\subsubsection{Omega Rotates}
\begin{verbatim}
    <card> ::= omega rotates : { yes | no } ;
\end{verbatim}
Sets whether the imposed angular velocity should be considered attached 
to the node or fixed in the global system during the initial assembly.

\subsubsection{Tolerance}
\begin{verbatim}
    <card> ::= tolerance : <tolerance> ;
\end{verbatim}
The tolerance that applies to the initial joint assembly; 
this tolerance is used to test the norm 2 of the residual,
because it is very important, for a correct start of the simulation,
that the algebraic constraints be satisfied as much as possible.
The alternate statement \kw{initial tolerance} is tolerated 
for backwards compatibility.

\subsubsection{Max Iterations}
\begin{verbatim}
    <card> ::= max iterations : <max_iterations> ;
\end{verbatim}
The number of iterations that are allowed during the initial assembly.
The alternate statement \kw{max initial iterations} is tolerated
for backwards compatibility.

\subsubsection{Title}
\begin{verbatim}
    <card> ::= title : " <simulation_title> " ;
\end{verbatim}

\subsubsection{Print}
\begin{verbatim}
    <card> ::= print : {
        dof stats |
        dof description |
        equation description |
        all |
        none
    } [ , ... ] ;
\end{verbatim}
The \kw{dof stats} keyword enables the printing of all potential
dof owner entities at initial assembly and at regular assembly,
so that the index of all variables can be easily identified.
The \kw{dof description} one adds extra variable description.
The \kw{equation description} one adds extra equation description.
The \kw{all} one enables all dof statistics printing.
The \kw{none} disables all dof statistics printing (the default).
Note that, apart from \kw{none}, the other values are additive, i.e.
\begin{verbatim}
    print: dof stats;
    print: dof description;
\end{verbatim}
is equivalent to 
\begin{verbatim}
    print: dof stats, dof description;
\end{verbatim}
while a 
\begin{verbatim}
    print: none;
\end{verbatim}
disables all.

\subsubsection{Make Restart File}
\begin{verbatim}
    <card> ::= make restart file
        [ : { iterations , <iterations_between_restarts>
            | time , <time_between_restarts> } ] ;
\end{verbatim}
The default (no arguments) is to make the restart file only at the end of
the simulation.

\subsubsection{Select Timeout}
\begin{verbatim}
    <card> ::= select timeout , <timeout> ;
\end{verbatim}
exit after \kw{<timeout>} minutes when waiting for connections 
on \kw{stream drives} or \kw{stream output elements}.
By default, no timeout is used, so \kw{select} waits forever.

\subsubsection{Default Output}\label{sec:CONTROLDATA:DEFAULTOUTPUT}
\begin{verbatim}
    <card> ::= default output : <output_list> ;
    <output_list> ::= { all | none | <output_item> } 
                      [ , <output_list> ]
    <output_item> ::=
        { reference frames
        |abstract nodes
        | electric nodes
        | hydraulic nodes
        | structural nodes
        | aerodynamic elements
        | air properties
        | beams
        | electric elements
        | forces
        | genels
        | gravity
        | hydraulic elements
        | joints
        | rigid bodies
        | rotors }
\end{verbatim}
Here the default output flag for a type of node or element can be set. It
can be overridden for every entity both when it is created or later in
each entity module.

\subsubsection{Output Frequency}
\label{sec:CONTROLDATA:OUTPUTFREQUENCY}
This statement is intended for producing partial output.
\begin{verbatim}
    <card> ::= output frequency: <steps> ;
\end{verbatim}
Despite the misleading name, this statement causes output to be produced
every \kw{<steps>} time steps, starting from the initial time.
A more general functionality is now provided by the \kw{output meter}
statement (Section~\ref{sec:CONTROLDATA:OUTPUTMETER}).

\subsubsection{Output Meter}
\label{sec:CONTROLDATA:OUTPUTMETER}
A drive that causes output to be generated when different from zero,
while no output is created when equal to zero.  It is useful to reduce 
the size of the output file during analysis phases that are not of interest.
\begin{verbatim}
    <card> ::= output meter: (DriveCaller)<meter> ;
\end{verbatim}
The functionality of the deprecated \kw{output frequency} statement
can be reproduced by using the \kw{meter} drive caller as follows:
\begin{verbatim}
    output meter: meter, 0., forever, steps, 10;
\end{verbatim}

\subsubsection{Output Precision}
Sets the desired output precision for those file types that allow it
(currently, all the native output except the \kw{.out} file; the
\kw{ADAMS} output, \kw{.res} files, are not affected.
The default is 6; since the output is in formatted plain text, the higher
precision, the larger the files and the slower the simulation.
\begin{verbatim}
    <card> ::= output precision : <number_of_digits> ;
\end{verbatim}
This will no longer be an issue when the binary output is implemented;
in that case, the output format will likely be fixed (float), or
an optional extended format (double) will be allowed.

\subsubsection{Output Results}
This deprecated statement was intended for producing output in formats
compatible with other software.
See Appendix~\ref{sec:APP:OUTPUTRESULTS} for a description of the types
of output that MBDyn can provide.
Most of them are produced in form of postprocessing, based on the default
raw output.

\subsubsection{Model}
\begin{verbatim}
    <card> ::= model : static ;
\end{verbatim}
This statement allows to set the model type to \kw{static}, which means
that all dynamic structural nodes will be treated as static, and inertia
forces ignored.
Gravity and centripetal acceleration will only be considered as forcing
terms.
See the \kw{structural} node (Section~\ref{sec:NODE:STRUCTURAL}) for details.


\section{Model Counter Cards}
The following counters can be defined:
\subsection{Nodes}
\begin{itemize}
\item \kw{abstract nodes}
\item \kw{electric nodes}
\item \kw{hydraulic nodes}
\item \kw{parameter nodes}
\item \kw{structural nodes}
\end{itemize}

\subsection{Drivers}
\begin{itemize}
\item \kw{file drivers}
\end{itemize}

\subsection{Elements}
\begin{itemize}
\item \kw{aerodynamic elements}
\item \kw{aeromodals}
\item \kw{air properties}
\item \kw{automatic structural elements}
\item \kw{beams}
\item \kw{bulk elements}
\item \kw{electric bulk elements}
\item \kw{electric elements}
\item \kw{external elements}
\item \kw{forces}
\item \kw{genels}
\item \kw{gravity}
\item \kw{hydraulic elements}
\item \kw{joints}
\item \kw{loadable elements}
\item \kw{output elements}
\item \kw{rigid bodies}
\item \kw{rotors}
\end{itemize}


