% MBDyn (C) is a multibody analysis code.
% http://www.mbdyn.org
%
% Copyright (C) 1996-2003
%
% Pierangelo Masarati  <masarati@aero.polimi.it>
%
% Dipartimento di Ingegneria Aerospaziale - Politecnico di Milano
% via La Masa, 34 - 20156 Milano, Italy
% http://www.aero.polimi.it
%
% Changing this copyright notice is forbidden.
%
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation (version 2 of the License).
% 
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

\documentclass[10pt,dvips]{report}

%\usepackage[pdftex]{graphicx}
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{html}

\input{stdmacro}
%poor man's bold symbol
\newcommand{\T}[1]{\boldsymbol{#1}}

\begin{document}

\begin{latexonly}
\title{\bf MBDyn Technical Manual \\
Version
\input{version}
}
\author{Pierangelo Masarati \vspace{5mm}\\
    \sc Dipartimento di Ingegneria Aerospaziale \\
    \sc Politecnico di Milano}
\date{\today}
\maketitle
\end{latexonly}

\begin{htmlonly}
\begin{center}
\textbf{\LARGE MBDyn Technical Manual}

\emph{\large Pierangelo Masarati}

\textsc{Dipartimento di Ingegneria Aerospaziale \\ Politecnico di Milano}

\today
\end{center}
\end{htmlonly}




\tableofcontents
\newpage

\chapter{Introduction}
This document describes details about the formulation MBDyn:
Multi-Body Dynamics relies on.

\chapter{Data Structure}

\chapter{Constraints}

\section{Algebraic Constraints}

\subsection{Distance Joint}

\subsubsection{Distance Joint Without Offsets}
Definitions
\begin{displaymath}
	u = \frac{1}{d}\plbr{x_2 - x_1}
\end{displaymath}
Limitations
\begin{displaymath}
	d > 0
\end{displaymath}
Constraint Equation
\begin{displaymath}
	d \sqrt{u^T u} = d
\end{displaymath}
Forces
\begin{eqnarray*}
	F_1 & = & \alpha u \\
	F_2 & = & -\alpha u
\end{eqnarray*}
Linearization
\begin{displaymath}
	\sqbr{\matr{ccc}{
		\frac{\alpha}{d}I & -\frac{\alpha}{d}I & -u \\
		-\frac{\alpha}{d}I & \frac{\alpha}{d}I & u \\
		-u^T & u^T & 0
	}}\cubr{\cvvect{
		\Delta{x_1} \\
		\Delta{x_2} \\
		\Delta{\alpha}
	}} = \cubr{\cvvect{
		\alpha u \\
		- \alpha u \\
		d\plbr{1 - \sqrt{u^T u}}
	}}
\end{displaymath}
Constraint Equation Derivative
\begin{displaymath}
	d u^T \dot{u} = 0
\end{displaymath}
Force Derivatives
\begin{eqnarray*}
	\dot{F}_1 & = & \alpha \dot{u} + \dot{\alpha} u \\
	\dot{F}_2 & = & -\alpha \dot{u} - \dot{\alpha} u
\end{eqnarray*}
Linearization
\begin{displaymath}
        \sqbr{\matr{cccccc}{
		\frac{\dot{\alpha}}{d}I & \frac{\alpha}{d}I &
			-\frac{\dot{\alpha}}{d}I & -\frac{\alpha}{d}I &
			-\dot{u} & -u \\
		-\frac{\dot{\alpha}}{d}I & -\frac{\alpha}{d}I &
			\frac{\dot{\alpha}}{d}I & \frac{\alpha}{d}I &
			\dot{u} & u \\
		-\dot{u}^T & -u^T & \dot{u}^T & u^T & 0 & 0
	}}\cubr{\cvvect{
		\Delta{x_1} \\
		\Delta{\dot{x}_1} \\
		\Delta{x_2} \\
		\Delta{\dot{x}_2} \\
		\Delta{\alpha} \\
		\Delta{\dot{\alpha}}
	}} = \cubr{\cvvect{
		\alpha \dot{u} + \dot{\alpha} u \\
		-\alpha \dot{u} - \dot{\alpha} u \\
		d u^T \dot{u}
	}}
\end{displaymath}




\subsubsection{Distance Joint With Offsets}
Definitions:
\begin{displaymath}
	u = \frac{1}{d}\plbr{x_2 + f_2 - x_1 - f_1}
\end{displaymath}
Limitations:
\begin{displaymath}
	d > 0
\end{displaymath}
Constraint equation 
\begin{displaymath}
	d \sqrt{u^T u} = d
\end{displaymath}
Forces:
\begin{eqnarray*}
	F_1 & = & \alpha u \\
	M_1 & = & \alpha f_1 \times u \\
	F_2 & = & -\alpha u \\
	M_2 & = & -\alpha f_2 \times u
\end{eqnarray*}
Linearization:
\begin{displaymath}
	\sqbr{\matr{ccccc}{
		\frac{\alpha}{d}I & -\frac{\alpha}{d}f_1\times{} &
			-\frac{\alpha}{d}I & \frac{\alpha}{d}f_2\times{} & -u \\
		\frac{\alpha}{d}f_1\times{} & 
			-\frac{\alpha}{d}\plbr{f_1 + u}\times{f_1\times{}} &
			-\frac{\alpha}{d}f_1\times{} & 
			\frac{\alpha}{d}f_1\times{f_2\times{}} & 
			-f_1\times{u} \\
		-\frac{\alpha}{d}I & \frac{\alpha}{d}f_1\times{} &
			\frac{\alpha}{d}I & -\frac{\alpha}{d}f_2\times{} & u \\
		-\frac{\alpha}{d}f_2\times{} &
			\frac{\alpha}{d}f_2\times{f_1\times{}} &
			\frac{\alpha}{d}f_2\times{} &
			- \frac{\alpha}{d}\plbr{f_2 - u}\times{f_2\times{}} &
			f_2\times{u} \\
		-u^T & - \plbr{f_1\times{u}}^T & 
			u^T & \plbr{f_2\times{u}}^T & 0
	}}\cubr{\cvvect{
		\Delta{x_1} \\
		\Delta{g_1} \\
		\Delta{x_2} \\
		\Delta{g_2} \\
		\Delta{\alpha}
	}}
\end{displaymath}
\begin{displaymath}
	\mbox{\hspace{100mm}} = \cubr{\cvvect{
		\alpha u \\
		\alpha f_1\times{u} \\
		-\alpha u \\
		-\alpha f_2\times{u} \\
		d\plbr{1 - \sqrt{u^T u}}
	}}
\end{displaymath}
Constraint Equation Derivative
\begin{displaymath}
	d u^T\dot{u} = 0
\end{displaymath}
Forces:
\begin{eqnarray*}
	\dot{F}_1 & = &  \alpha \dot{u} + \dot{\alpha} u \\
	\dot{M}_1 & = & \alpha \plbr{\omega_1\times{f_1}} \times u 
		+ \alpha f_1 \times \dot{u}
		+ \dot{\alpha} f_1 \times u \\
	\dot{F}_2 & = & -\alpha \dot{u} - \dot{\alpha} u \\
	\dot{M}_2 & = & -\alpha \plbr{\omega_2 \times{f_2}} \times u
		- \alpha f_2 \times \dot{u}
		- \dot{\alpha} f_2 \times u
\end{eqnarray*}
Linearization:

\subsection{Revolute hinge (PlaneHingeJoint)}
Joint data
\begin{displaymath}
\T d_1, \T d_2, \T R_{h1}, \T R_{h2}
\end{displaymath}
where:\\
$\T d_1$, $\T d_2$: offset of nodes 1,2 in node reference;\\
$\T R_{h1}$, $\T R_{h2}$: joint relative orientation wrt. nodes 1,2 (FIXME).\\

\noindent
Equations
\begin{eqnarray*}
	(\T x_1+\T R_1\cdot \T d_1) - (\T x_2+\T R_1\cdot \T d_2)& = & 0 \\
	(\T R_1\cdot \T R_{h1})[3]\cdot (\T R_2\cdot \T R_{h2})[2] & = & 0 \\
	(\T R_1\cdot \T R_{h1})[3]\cdot (\T R_2\cdot \T R_{h2})[1] & = & 0 \\
\end{eqnarray*}
where:\\
$\T x_1$, $\T x_2$: positions of nodes 1,2;\\
$\T R_{1}$, $\T R_{2}$: orientation of nodes 1,2.\\


\section{Deformable Constraints}

\subsection{Deformable Hinge}



\bibliographystyle{unsrt}
\bibliography{mybib}


\pagebreak
\noindent
Pierangelo Masarati \\
Dipartimento di Ingegneria Aerospaziale, Politecnico di Milano \\
via La Masa 34, 20156 Milano, Italy \\
Tel.: ++39 02 2399 8309 \\
Fax: ++39 02 2399 8334 \\
E-mail: \htmladdnormallink{\texttt{masarati@aero.polimi.it}}{mailto:masarati@aero.polimi.it} \\
Web: \htmladdnormallink{\texttt{http://www.aero.polimi.it/\~{}mbdyn/}}{http://www.aero.polimi.it/~mbdyn/} \\
Web: \htmladdnormallink{\texttt{http://www.aero.polimi.it/\~{}masarati/}}{http://www.aero.polimi.it/~masarati/} \\
Web: \htmladdnormallink{\texttt{http://mbdyn.aero.polimi.it/\~{}masarati/MBDyn-input/manual/index.html}}{http://mbdyn.aero.polimi.it/~masarati/MBDyn-input/manual/index.html}

\end{document}
