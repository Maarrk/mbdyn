#!/bin/sh

# MBDyn (C) is a multibody analysis code. 
# http://www.mbdyn.org
# 
# Copyright (C) 1996-2006
# 
# Pierangelo Masarati	<masarati@aero.polimi.it>
# Paolo Mantegazza	<mantegazza@aero.polimi.it>
# 
# Dipartimento di Ingegneria Aerospaziale - Politecnico di Milano
# via La Masa, 34 - 20156 Milano, Italy
# http://www.aero.polimi.it
# 
# Changing this copyright notice is forbidden.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation (version 2 of the License).
# 
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

# Prepare MBDyn ASCII output (.log & .mov files) for loading within EasyAnim
#
# EasyAnim is a simple package for the visualization of mechanical systems
# it can be downloaded from http://mecara.fpms.ac.be/EasyDyn/
# For information, contact
#
# Prof. Olivier VERLINDEN
# Faculte Polytechnique de Mons
# Department of Theoretical Mechanics, Dynamics and Vibrations
# 31, Bd Dolez; 7000 MONS (BELGIUM)
# E-mail: Olivier.Verlinden@fpms.ac.be
#
# Usage:
#
# mbdyn2easyanim.sh <filename>

if test "x$1" = "x" ; then
	echo "usage: mbdyn2easyanim.sh <filename>"
fi

FILENAME=$1
MBDYN2EASYANIM="@AWKDIR@/mbdyn2easyanim.awk"

if test "x${FILENAME}.log" = "x" ; then
	echo "missing log file \"${FILENAME}.log\""
	exit 1
fi

if test "x${FILENAME}.mov" = "x" ; then
	echo "missing mov file \"${FILENAME}.mov\""
	exit 1
fi

echo "####" | \
	cat "${FILENAME}.log" - "${FILENAME}.mov" | \
	awk -f "${MBDYN2EASYANIM}" -vFILENAME="${FILENAME}"
RC=$?
if test $RC != 0 ; then
	echo "conversion failed ($RC)"
	exit $RC
fi

if test ! -f "x${FILENAME}.vol" -o ! -f "x${FILENAME}.van" ; then
	echo "conversion failed (no files)"
	exit 1
fi

exit 0
